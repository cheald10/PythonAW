{% extends "base.html" %}
{% load static %}

{% block title %}Home - Baseball Pick 4{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1>Welcome, {{ user.first_name|default:user.username }}!</h1>
            <p class="lead">Your Baseball Pick 4 Dashboard</p>
        </div>
    </div>

    {% if current_week %}
    <div class="row mt-4">
        <!-- Current Week Info -->
        <div class="col-md-6 mb-4">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt"></i>
                        Week {{ current_week.week_number }} - {{ current_week.season_year }}
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong>Deadline:</strong> {{ current_week.deadline_utc|date:"M d, Y g:i A" }} UTC
                    </p>

                    {% if time_remaining %}
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-clock"></i>
                            <strong>Time Remaining:</strong> {{ time_remaining }}
                        </div>
                    {% else %}
                        <div class="alert alert-danger mb-3">
                            <i class="fas fa-lock"></i>
                            <strong>Picks are locked!</strong> Deadline has passed.
                        </div>
                    {% endif %}

                    <div class="mb-3">
                        <strong>Picks Made:</strong>
                        <span class="badge {% if picks_made == 4 %}bg-success{% elif picks_made > 0 %}bg-warning{% else %}bg-secondary{% endif %} fs-6">
                            {{ picks_made }}/4
                        </span>
                    </div>

                    {% if picks_made < 4 %}
                        <div class="progress mb-3" style="height: 25px;">
                            <div class="progress-bar {% if picks_made == 0 %}bg-secondary{% elif picks_made < 4 %}bg-warning{% else %}bg-success{% endif %}"
                                 role="progressbar"
                                 style="width: {% widthratio picks_made 1 25 %}%;"
                                 aria-valuenow="{% widthratio picks_made 1 25 %}"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                {{ picks_made }} of 4
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    {% if time_remaining %}
                        {% if picks_made < 4 %}
                            <a href="{% url 'make_picks' %}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-plus-circle"></i> Make Picks
                            </a>
                        {% else %}
                            <a href="{% url 'make_picks' %}" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-edit"></i> Edit Picks
                            </a>
                        {% endif %}
                    {% else %}
                        <button class="btn btn-secondary btn-lg w-100" disabled>
                            <i class="fas fa-lock"></i> Deadline Passed
                        </button>
                    {% endif %}

                    {% if picks_made > 0 %}
                        <a href="{% url 'view_picks' %}" class="btn btn-outline-primary w-100 mt-2">
                            <i class="fas fa-eye"></i> View Your Picks
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- My Teams Section -->
        <div class="col-md-6 mb-4">
            {% if user_teams %}
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-users"></i> My Teams
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2 mb-3">
                        {% for membership in user_teams %}
                            <a href="{% url 'team_detail' membership.team.id %}" class="text-decoration-none">
                                <span class="badge bg-{% if membership.role == 'captain' %}warning text-dark{% else %}secondary{% endif %} fs-6 px-3 py-2">
                                    {% if membership.role == 'captain' %}
                                        <i class="fas fa-crown"></i>
                                    {% else %}
                                        <i class="fas fa-user"></i>
                                    {% endif %}
                                    {{ membership.team.name }}
                                </span>
                            </a>
                        {% endfor %}
                    </div>
                    <div class="d-grid gap-2">
                        <a href="{% url 'my_teams' %}" class="btn btn-outline-primary">
                            <i class="fas fa-list"></i> View All Teams
                        </a>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card border-warning">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle"></i> No Team Yet!
                    </h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">You need to join or create a team to make picks.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'create_team' %}" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i> Create Team
                        </a>
                        <a href="{% url 'join_team' %}" class="btn btn-success">
                            <i class="fas fa-sign-in-alt"></i> Join Team
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Second Row: User Stats -->
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line"></i>
                        Your Stats
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-star text-warning fa-2x mb-2"></i>
                                <h6>Season Points</h6>
                                <h3 class="text-warning">{{ season_points }}</h3>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-trophy text-success fa-2x mb-2"></i>
                                <h6>Season Rank</h6>
                                <h3 class="text-success">{{ season_rank }}</h3>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3">
                                <i class="fas fa-calendar-week text-info fa-2x mb-2"></i>
                                <h6>This Week</h6>
                                <h3 class="text-info">{{ week_points }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-link"></i>
                        Quick Links
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-2">
                            <a href="{% url 'leaderboard' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-list-ol"></i> Leaderboard
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-2">
                            <a href="{% url 'weekly_results' %}" class="btn btn-outline-success w-100">
                                <i class="fas fa-chart-bar"></i> Results
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-2">
                            <a href="{% url 'rules' %}" class="btn btn-outline-info w-100">
                                <i class="fas fa-book"></i> Rules
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-2">
                            <a href="{% url 'account_settings' %}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- No Active Week Message -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info">
                <h4><i class="fas fa-info-circle"></i> No Active Week</h4>
                <p>There is currently no active game week. Please check back later or contact your league administrator!</p>
                <hr>
                <p class="mb-0">
                    <a href="{% url 'rules' %}" class="btn btn-primary">
                        <i class="fas fa-book"></i> Learn How to Play
                    </a>
                </p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
